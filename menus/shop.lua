function ws.shop(n,cannon,plank,anvil)
    close(n)
    ui.addButton(7,cannon and "<p align='center'>Planks</p>" or "<p align='center'>Cannons</p>",n,cannon and "planks" or "cannons",125,70,70,13,true)
    ui.addButton(8,cannon and "<p align='center'>Anvils</p>" or (plank and "<p align='center'>Anvils</p>" or "<p align='center'>Planks</p>"),n,cannon and "anvils" or (plank and "anvils" or "planks"),125,110,70,13,true)
    ui.addPopup(1,nil,"",n,nil,nil,400,280,1,true,3)
    ui.addButton(1,"<p align='center'>"..text[n].close.."</p>",n,"close",nil,320,140,10,true)
    if not plank then
        if cannon then
            p[n].cannonShop,p[n].plankShop,p[n].anvilShop,p[n].shop=true,false,false,12
            ui.addPopup(5,nil,"<p align='center'>"..string.format(text[n].quests[stuff[12][p[n].sub[1]].text],data[n][stuff[12][p[n].sub[1]].type],stuff[12][p[n].sub[1]].req),n,275,90,210,40,1,true,3)
            ui.addPopup(6,nil,"<p align='center'>"..string.format(text[n].quests[stuff[12][p[n].sub[2]].text],data[n][stuff[12][p[n].sub[2]].type],stuff[12][p[n].sub[2]].req),n,275,165,210,40,1,true,3)
            ui.addPopup(7,nil,"<p align='center'>"..string.format(text[n].quests[stuff[12][p[n].sub[3]].text],data[n][stuff[12][p[n].sub[3]].type],stuff[12][p[n].sub[3]].req),n,275,245,210,40,1,true,3)
            ui.addButton(4,data[n][12]==stuff[12][p[n].sub[1]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[12][p[n].sub[1]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[12][p[n].sub[1]].type] >= stuff[12][p[n].sub[1]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][12]==stuff[12][p[n].sub[1]].id and ("uneq_12") or (n==stuff[12][p[n].sub[1]].artist and "eq_12_"..stuff[12][p[n].sub[1]].id or n=="Bodykudo#0000" and "eq_12_"..stuff[12][p[n].sub[1]].id or (data[n][stuff[12][p[n].sub[1]].type] >= stuff[12][p[n].sub[1]].req and "eq_12_"..stuff[12][p[n].sub[1]].id or "")),503,103,80,13,true)
            ui.addButton(5,data[n][12]==stuff[12][p[n].sub[2]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[12][p[n].sub[2]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or  (data[n][stuff[12][p[n].sub[2]].type] >= stuff[12][p[n].sub[2]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][12]==stuff[12][p[n].sub[2]].id and ("uneq_12") or (n==stuff[12][p[n].sub[2]].artist and "eq_12_"..stuff[12][p[n].sub[2]].id or n=="Bodykudo#0000" and "eq_12_"..stuff[12][p[n].sub[2]].id or (data[n][stuff[12][p[n].sub[2]].type] >= stuff[12][p[n].sub[2]].req and "eq_12_"..stuff[12][p[n].sub[2]].id or "")),503,178,80,13,true)
            ui.addButton(6,data[n][12]==stuff[12][p[n].sub[3]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[12][p[n].sub[3]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or  (data[n][stuff[12][p[n].sub[3]].type] >= stuff[12][p[n].sub[3]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][12]==stuff[12][p[n].sub[3]].id and ("uneq_12") or (n==stuff[12][p[n].sub[3]].artist and "eq_12_"..stuff[12][p[n].sub[3]].id or n=="Bodykudo#0000" and "eq_12_"..stuff[12][p[n].sub[3]].id or (data[n][stuff[12][p[n].sub[3]].type] >= stuff[12][p[n].sub[3]].req and "eq_12_"..stuff[12][p[n].sub[3]].id or "")),503,257,80,13,true)
            ui.addButton(2,"<p align='center'>"..text[n].next.."</p>",p[n].shPage==#stuff[12]/3 and "n" or n,"next",490,320,80,10,true)
            ui.addButton(3,"<p align='center'>"..text[n].pre.."</p>",p[n].shPage==1 and "n" or n,"pre",230,320,80,10,true)
            id.shop[1][n]=tfm.exec.addImage(stuff[12][p[n].sub[1]].inShop..".png","&1",205+((65-stuff[12][p[n].sub[1]].w)/2), 75+((65-stuff[12][p[n].sub[1]].h)/2),n)
            id.shop[2][n]=tfm.exec.addImage(stuff[12][p[n].sub[2]].inShop..".png","&2",205+((65-stuff[12][p[n].sub[2]].w)/2), 155+((65-stuff[12][p[n].sub[2]].h)/2),n)
            id.shop[3][n]=tfm.exec.addImage(stuff[12][p[n].sub[3]].inShop..".png","&3",205+((65-stuff[12][p[n].sub[3]].w)/2), 235+((65-stuff[12][p[n].sub[3]].h)/2),n)
        else
            p[n].cannonShop,p[n].plankShop,p[n].anvilShop,p[n].shop=false,false,true,14
            ui.addPopup(5,nil,"<p align='center'>"..string.format(text[n].quests[stuff[14][p[n].sub[1]].text],data[n][stuff[14][p[n].sub[1]].type],stuff[14][p[n].sub[1]].req),n,275,90,210,40,1,true,3)
            ui.addPopup(6,nil,"<p align='center'>"..string.format(text[n].quests[stuff[14][p[n].sub[2]].text],data[n][stuff[14][p[n].sub[2]].type],stuff[14][p[n].sub[2]].req),n,275,165,210,40,1,true,3)
            ui.addPopup(7,nil,"<p align='center'>"..string.format(text[n].quests[stuff[14][p[n].sub[3]].text],data[n][stuff[14][p[n].sub[3]].type],stuff[14][p[n].sub[3]].req),n,275,245,210,40,1,true,3)
            ui.addButton(4,data[n][14]==stuff[14][p[n].sub[1]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[14][p[n].sub[1]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[14][p[n].sub[1]].type] >= stuff[14][p[n].sub[1]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][14]==stuff[14][p[n].sub[1]].id and ("uneq_14") or (n==stuff[14][p[n].sub[1]].artist and "eq_14_"..stuff[14][p[n].sub[1]].id or n=="Bodykudo#0000" and "eq_14_"..stuff[14][p[n].sub[1]].id or (data[n][stuff[14][p[n].sub[1]].type] >= stuff[14][p[n].sub[1]].req and "eq_14_"..stuff[14][p[n].sub[1]].id or "")),503,103,80,13,true)
            ui.addButton(5,data[n][14]==stuff[14][p[n].sub[2]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[14][p[n].sub[2]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[14][p[n].sub[2]].type] >= stuff[14][p[n].sub[2]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][14]==stuff[14][p[n].sub[2]].id and ("uneq_14") or (n==stuff[14][p[n].sub[2]].artist and "eq_14_"..stuff[14][p[n].sub[2]].id or n=="Bodykudo#0000" and "eq_14_"..stuff[14][p[n].sub[2]].id or (data[n][stuff[14][p[n].sub[2]].type] >= stuff[14][p[n].sub[2]].req and "eq_14_"..stuff[14][p[n].sub[2]].id or "")),503,178,80,13,true)
            ui.addButton(6,data[n][14]==stuff[14][p[n].sub[3]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[14][p[n].sub[3]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[14][p[n].sub[3]].type] >= stuff[14][p[n].sub[3]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][14]==stuff[14][p[n].sub[3]].id and ("uneq_14") or (n==stuff[14][p[n].sub[3]].artist and "eq_14_"..stuff[14][p[n].sub[3]].id or n=="Bodykudo#0000" and "eq_14_"..stuff[14][p[n].sub[3]].id or (data[n][stuff[14][p[n].sub[3]].type] >= stuff[14][p[n].sub[3]].req and "eq_14_"..stuff[14][p[n].sub[3]].id or "")),503,257,80,13,true)
            ui.addButton(2,"<p align='center'>"..text[n].next.."</p>",p[n].shPage==#stuff[14]/3 and "n" or n,"next",490,320,80,10,true)
            ui.addButton(3,"<p align='center'>"..text[n].pre.."</p>",p[n].shPage==1 and "n" or n,"pre",230,320,80,10,true)
            id.shop[1][n]=tfm.exec.addImage(stuff[14][p[n].sub[1]].inShop..".png","&1",205+((65-stuff[14][p[n].sub[1]].w)/2), 75+((65-stuff[14][p[n].sub[1]].h)/2),n)
            id.shop[2][n]=tfm.exec.addImage(stuff[14][p[n].sub[2]].inShop..".png","&2",205+((65-stuff[14][p[n].sub[2]].w)/2), 155+((65-stuff[14][p[n].sub[2]].h)/2),n)
            id.shop[3][n]=tfm.exec.addImage(stuff[14][p[n].sub[3]].inShop..".png","&3",205+((65-stuff[14][p[n].sub[3]].w)/2), 235+((65-stuff[14][p[n].sub[3]].h)/2),n)
        end
        ui.addPopup(2,nil,"",n,205,75,65,65,1,true,3)
        ui.addPopup(3,nil,"",n,205,155,65,65,1,true,3)
        ui.addPopup(4,nil,"",n,205,235,65,65,1,true,3)
    else
        p[n].cannonShop,p[n].plankShop,p[n].anvilShop,p[n].shop=false,true,false,13
        ui.addPopup(5,nil,"<p align='center'>\n"..string.format(text[n].quests[stuff[13][p[n].sub[1]].text],data[n][stuff[13][p[n].sub[1]].type],stuff[13][p[n].sub[1]].req),n,215,110,100,120,1,true,3)
        ui.addPopup(6,nil,"<p align='center'>\n"..string.format(text[n].quests[stuff[13][p[n].sub[2]].text],data[n][stuff[13][p[n].sub[2]].type],stuff[13][p[n].sub[2]].req),n,350,110,100,120,1,true,3)
        ui.addPopup(7,nil,"<p align='center'>\n"..string.format(text[n].quests[stuff[13][p[n].sub[3]].text],data[n][stuff[13][p[n].sub[3]].type],stuff[13][p[n].sub[3]].req),n,485,110,100,120,1,true,3)
        ui.addButton(4,data[n][13]==stuff[13][p[n].sub[1]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[13][p[n].sub[1]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[13][p[n].sub[1]].type] >= stuff[13][p[n].sub[1]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][13]==stuff[13][p[n].sub[1]].id and ("uneq_13") or (n==stuff[13][p[n].sub[1]].artist and "eq_13_"..stuff[13][p[n].sub[1]].id or n=="Bodykudo#0000" and "eq_13_"..stuff[13][p[n].sub[1]].id or (data[n][stuff[13][p[n].sub[1]].type] >= stuff[13][p[n].sub[1]].req and "eq_13_"..stuff[13][p[n].sub[1]].id or "")),225,260,80,13,true)
        ui.addButton(5,data[n][13]==stuff[13][p[n].sub[2]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[13][p[n].sub[2]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[13][p[n].sub[2]].type] >= stuff[13][p[n].sub[2]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][13]==stuff[13][p[n].sub[2]].id and ("uneq_13") or (n==stuff[13][p[n].sub[2]].artist and "eq_13_"..stuff[13][p[n].sub[2]].id or n=="Bodykudo#0000" and "eq_13_"..stuff[13][p[n].sub[2]].id or (data[n][stuff[13][p[n].sub[2]].type] >= stuff[13][p[n].sub[2]].req and "eq_13_"..stuff[13][p[n].sub[2]].id or "")),360,260,80,13,true)
        ui.addButton(6,data[n][13]==stuff[13][p[n].sub[3]].id and ("<p align='center'>"..text[n].uneq) or (n==stuff[13][p[n].sub[3]].artist and ("<p align='center'>"..text[n].eq) or  n=="Bodykudo#0000" and ("<p align='center'>"..text[n].eq) or (data[n][stuff[13][p[n].sub[3]].type] >= stuff[13][p[n].sub[3]].req and "<p align='center'>"..text[n].eq or "<p align='center'>"..text[n].disabled)),n,data[n][13]==stuff[13][p[n].sub[3]].id and ("uneq_13") or (n==stuff[13][p[n].sub[3]].artist and "eq_13_"..stuff[13][p[n].sub[3]].id or n=="Bodykudo#0000" and "eq_13_"..stuff[13][p[n].sub[3]].id or (data[n][stuff[13][p[n].sub[3]].type] >= stuff[13][p[n].sub[3]].req and "eq_13_"..stuff[13][p[n].sub[3]].id or "")),495,260,80,13,true)
        ui.addButton(2,"<p align='center'>"..text[n].next.."</p>",p[n].shPage==#stuff[13]/3 and "" or n,"next",490,320,80,10,true)
        ui.addButton(3,"<p align='center'>"..text[n].pre.."</p>",p[n].shPage==1 and "n" or n,"pre",230,320,80,10,true)
        ui.addPopup(2,nil,"",n,205,85,120,20,1,true,3)
        ui.addPopup(3,nil,"",n,340,85,120,20,1,true,3)
        ui.addPopup(4,nil,"",n,475,85,120,20,1,true,3)
        id.shop[1][n]=tfm.exec.addImage(stuff[13][p[n].sub[1]].inShop..".png","&1",205+((120-stuff[13][p[n].sub[1]].w)/2), 85+((20-stuff[13][p[n].sub[1]].h)/2),n)
        id.shop[2][n]=tfm.exec.addImage(stuff[13][p[n].sub[2]].inShop..".png","&2",340+((120-stuff[13][p[n].sub[2]].w)/2), 85+((20-stuff[13][p[n].sub[2]].h)/2),n)
        id.shop[3][n]=tfm.exec.addImage(stuff[13][p[n].sub[3]].inShop..".png","&3",475+((120-stuff[13][p[n].sub[3]].w)/2), 85+((20-stuff[13][p[n].sub[3]].h)/2),n)
    end
end